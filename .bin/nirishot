#!/usr/bin/env bash

function check_dependencies() {
  local ret=0
  for cmd in "$@"; do
    if ! command -v "$cmd" >/dev/null 2>&1; then
      echo "Missing dependency: $cmd."
      ret=1
    fi
  done
  return $ret
}

(check_dependencies "niri" "slurp" "grim" "dunstify" "swappy") || exit 1

# path to save the file
PIC_PATH="$HOME/.pictures"
if ! [[ -d "$PIC_PATH" ]]; then
  mkdir "$PIC_PATH"
  echo "Pictures folder was created"
fi

# get current monitor name
current_monitor=$(niri msg -j focused-output | jq -r '.name')

# logic to create a name for the file
if [[ -z "$1" ]]; then
  file_name="$PIC_PATH"/"$current_monitor"_$(date +'%Y%m%d%H%M%S').jpg
else
  file_name="$PIC_PATH"/"$current_monitor"_$1_$(date +'%Y%m%d%H%M%S').jpg
fi

case "$1" in
  region)
    grim -g "$(slurp)" "$file_name" && dunstify "Region screenshot was saved"
    ;;
  edit)
    grim -g "$(slurp)" - | swappy -f - && dunstify "An edited screenshot was saved"
    ;;
  *)
    grim -o "$current_monitor" "$file_name" && dunstify "Screenshot was saved"
    ;;
esac

